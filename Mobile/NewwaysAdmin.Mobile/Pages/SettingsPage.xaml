<?xml version="1.0" encoding="utf-8" ?>
<!-- File: NewwaysAdmin.Mobile/Pages/SettingsPage.xaml -->
<!-- UPDATED: Added date range and batch upload support -->
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="NewwaysAdmin.Mobile.Pages.SettingsPage"
             Title="Settings"
             BackgroundColor="White">

    <ScrollView>
        <StackLayout Padding="20" Spacing="15">

            <!-- User Info Section -->
            <Label Text="Settings" 
                   FontSize="28" 
                   FontAttributes="Bold"
                   TextColor="#1565C0"/>

            <Frame BackgroundColor="#F5F5F5" 
                   Padding="15" 
                   CornerRadius="10">
                <StackLayout Spacing="5">
                    <Label Text="Logged in as" 
                           FontSize="12" 
                           TextColor="Gray"/>
                    <Label x:Name="UsernameLabel" 
                           Text="Loading..." 
                           FontSize="18" 
                           FontAttributes="Bold"/>
                </StackLayout>
            </Frame>

            <!-- Server Info -->
            <Frame BackgroundColor="#F5F5F5" 
                   Padding="15" 
                   CornerRadius="10">
                <StackLayout Spacing="5">
                    <Label Text="Server" 
                           FontSize="12" 
                           TextColor="Gray"/>
                    <Label x:Name="ServerLabel" 
                           Text="..." 
                           FontSize="14"/>
                </StackLayout>
            </Frame>

            <!-- App Info Section -->
            <Frame BackgroundColor="#F5F5F5" 
                   Padding="15" 
                   CornerRadius="10">
                <StackLayout Spacing="5">
                    <Label Text="App Version" 
                           FontSize="12" 
                           TextColor="Gray"/>
                    <Label Text="1.0.0" 
                           FontSize="16"/>
                </StackLayout>
            </Frame>

            <BoxView HeightRequest="1" Color="LightGray" Margin="0,10" />

            <!-- ========== BANK SLIP AUTO-SYNC SECTION ========== -->
            <Label Text="📸 Bank Slip Auto-Sync" 
                   FontSize="20" 
                   FontAttributes="Bold"
                   Margin="0,10,0,5"/>

            <!-- Enable/Disable Toggle -->
            <Frame BackgroundColor="#F5F5F5" 
                   Padding="15" 
                   CornerRadius="10">
                <Grid ColumnDefinitions="*,Auto">
                    <StackLayout Grid.Column="0" VerticalOptions="Center">
                        <Label Text="Auto-sync enabled" 
                               FontSize="16"/>
                        <Label Text="Automatically upload new bank slip screenshots" 
                               FontSize="12" 
                               TextColor="Gray"/>
                    </StackLayout>
                    <Switch x:Name="EnabledSwitch" 
                            Grid.Column="1"
                            VerticalOptions="Center"
                            Toggled="OnEnabledToggled"/>
                </Grid>
            </Frame>

            <!-- Monitored Folders Section -->
            <Frame BackgroundColor="#F5F5F5" 
                   Padding="15" 
                   CornerRadius="10">
                <StackLayout Spacing="10">
                    <Label Text="Monitored Folders" 
                           FontSize="16" 
                           FontAttributes="Bold"/>
                    <Label Text="Select a folder and give it a pattern name for OCR" 
                           FontSize="12" 
                           TextColor="Gray"/>

                    <!-- Add folder section -->
                    <Frame BackgroundColor="White" Padding="10" CornerRadius="5">
                        <StackLayout Spacing="8">

                            <!-- Browse button + selected path display -->
                            <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                <Button x:Name="BrowseFolderButton"
                                        Grid.Column="0"
                                        Text="📁 Browse"
                                        Clicked="OnBrowseFolderClicked"
                                        BackgroundColor="#2196F3"
                                        TextColor="White"
                                        FontSize="14"
                                        HeightRequest="40"
                                        CornerRadius="5"/>
                                <Label x:Name="SelectedFolderLabel"
                                       Grid.Column="1"
                                       Text="No folder selected"
                                       FontSize="12"
                                       TextColor="Gray"
                                       VerticalOptions="Center"
                                       LineBreakMode="TailTruncation"/>
                            </Grid>

                            <!-- Pattern name entry -->
                            <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                <Label Grid.Column="0"
                                       Text="Pattern:"
                                       FontSize="14"
                                       VerticalOptions="Center"/>
                                <Entry x:Name="PatternNameEntry"
                                       Grid.Column="1"
                                       Placeholder="e.g., KPLUS_Thomas"
                                       FontSize="14"/>
                            </Grid>

                            <!-- Add button -->
                            <Button x:Name="AddFolderButton"
                                    Text="+ Add Folder"
                                    Clicked="OnAddFolderClicked"
                                    BackgroundColor="#4CAF50"
                                    TextColor="White"
                                    FontSize="14"
                                    HeightRequest="40"
                                    CornerRadius="5"/>
                        </StackLayout>
                    </Frame>

                    <!-- Folder list -->
                    <StackLayout x:Name="FolderListContainer" Spacing="5">
                        <!-- Folders will be added here dynamically -->
                        <Label x:Name="NoFoldersLabel" 
                               Text="No folders configured" 
                               FontSize="14" 
                               TextColor="Gray"
                               HorizontalOptions="Center"/>
                    </StackLayout>
                </StackLayout>
            </Frame>

            <!-- Date Range Section -->
            <Frame BackgroundColor="#F5F5F5" 
                   Padding="15" 
                   CornerRadius="10">
                <StackLayout Spacing="10">
                    <Label Text="📅 Date Range" 
                           FontSize="16" 
                           FontAttributes="Bold"/>

                    <!-- Sync From Date -->
                    <StackLayout Spacing="5">
                        <Label Text="From date" 
                               FontSize="14"/>
                        <Label Text="Only upload images newer than this date" 
                               FontSize="11" 
                               TextColor="Gray"/>
                        <DatePicker x:Name="SyncFromDatePicker"
                                    DateSelected="OnSyncFromDateChanged"
                                    Format="yyyy-MM-dd"/>
                    </StackLayout>

                    <!-- Date Range Toggle -->
                    <Grid ColumnDefinitions="*,Auto" Margin="0,5">
                        <StackLayout Grid.Column="0" VerticalOptions="Center">
                            <Label Text="Use date range (batch mode)" 
                                   FontSize="14"/>
                            <Label Text="Set an end date for historical uploads" 
                                   FontSize="11" 
                                   TextColor="Gray"/>
                        </StackLayout>
                        <Switch x:Name="DateRangeSwitch" 
                                Grid.Column="1"
                                VerticalOptions="Center"
                                Toggled="OnDateRangeToggled"/>
                    </Grid>

                    <!-- Sync To Date (visible when date range is enabled) -->
                    <StackLayout x:Name="SyncToDateContainer" 
                                 Spacing="5" 
                                 IsVisible="False">
                        <Label Text="To date" 
                               FontSize="14"/>
                        <Label Text="Only upload images older than this date" 
                               FontSize="11" 
                               TextColor="Gray"/>
                        <DatePicker x:Name="SyncToDatePicker"
                                    DateSelected="OnSyncToDateChanged"
                                    Format="yyyy-MM-dd"/>
                    </StackLayout>

                    <!-- Pending Count Display -->
                    <Frame BackgroundColor="#E3F2FD" 
                           Padding="10" 
                           CornerRadius="5"
                           Margin="0,5">
                        <Label x:Name="PendingCountLabel"
                               Text="0 files pending"
                               FontSize="14"
                               TextColor="#1565C0"
                               HorizontalOptions="Center"/>
                    </Frame>
                </StackLayout>
            </Frame>

            <!-- Batch Upload Button -->
            <Button x:Name="BatchUploadButton"
                    Text="📤 Batch Upload"
                    Clicked="OnBatchUploadClicked"
                    BackgroundColor="#9C27B0"
                    TextColor="White"
                    FontSize="16"
                    HeightRequest="50"
                    CornerRadius="10"/>

            <!-- Batch Progress (hidden by default) -->
            <Frame x:Name="BatchProgressContainer" 
                   BackgroundColor="#F3E5F5" 
                   Padding="15" 
                   CornerRadius="10"
                   IsVisible="False">
                <StackLayout Spacing="8">
                    <Label Text="Uploading..." 
                           FontSize="14" 
                           FontAttributes="Bold"
                           TextColor="#7B1FA2"/>
                    <ProgressBar x:Name="BatchProgressBar" 
                                 Progress="0"
                                 ProgressColor="#9C27B0"/>
                    <Label x:Name="BatchProgressLabel"
                           Text=""
                           FontSize="12"
                           TextColor="Gray"
                           HorizontalOptions="Center"/>
                </StackLayout>
            </Frame>

            <!-- Manual Scan Button -->
            <Button x:Name="ScanNowButton"
                    Text="🔍 Scan Now"
                    Clicked="OnScanNowClicked"
                    BackgroundColor="#FF9800"
                    TextColor="White"
                    FontSize="16"
                    HeightRequest="50"
                    CornerRadius="10"/>

            <!-- Status Display -->
            <Label x:Name="BankSlipStatusLabel" 
                   Text="" 
                   FontSize="14" 
                   TextColor="#1565C0"
                   HorizontalOptions="Center"
                   Margin="0,5"/>

            <!-- ========== END BANK SLIP SECTION ========== -->

            <BoxView HeightRequest="1" Color="LightGray" Margin="0,10" />

            <!-- Logout Button -->
            <Button Text="🚪 Sign Out"
                    Clicked="OnLogoutClicked"
                    BackgroundColor="#E53935"
                    TextColor="White"
                    FontSize="16"
                    HeightRequest="50"
                    CornerRadius="10"/>

            <!-- Bottom padding -->
            <BoxView HeightRequest="30" Color="Transparent" />

        </StackLayout>
    </ScrollView>

</ContentPage>
