@* File: NewwaysAdmin.WebAdmin/Components/Features/Accounting/CategoryManagement/CategoryList.razor *@
@using NewwaysAdmin.SharedModels.Categories

<div class="card">
    <div class="card-header">
        <h5 class="mb-0">Categories & Subcategories</h5>
    </div>
    <div class="card-body p-0">
        @if (Categories?.Any() == true)
        {
            @foreach (var category in Categories.OrderBy(c => c.SortOrder))
            {
                <CategoryItem 
                    Category="category"
                    IsExpanded="expandedCategoryId == category.Id"
                    OnToggleExpanded="() => ToggleCategory(category.Id)"
                    OnEditCategory="OnEditCategory"
                    OnDeleteCategory="OnDeleteCategory"
                    OnAddSubCategory="OnAddSubCategory"
                    OnEditSubCategory="OnEditSubCategory"
                    OnDeleteSubCategory="OnDeleteSubCategory" />
            }
        }
        else
        {
            <div class="text-center text-muted py-5">
                <i class="fas fa-folder-open fa-3x mb-3 text-muted"></i>
                <h6>No categories found</h6>
                <p class="mb-0">Add your first category to get started</p>
            </div>
        }
    </div>
</div>

@code {
    [Parameter] public List<Category>? Categories { get; set; }
    [Parameter] public EventCallback<Category> OnEditCategory { get; set; }
    [Parameter] public EventCallback<Category> OnDeleteCategory { get; set; }
    [Parameter] public EventCallback<Category> OnAddSubCategory { get; set; }
    [Parameter] public EventCallback<ValueTuple<Category, SubCategory>> OnEditSubCategory { get; set; }
    [Parameter] public EventCallback<ValueTuple<Category, SubCategory>> OnDeleteSubCategory { get; set; }

    private string? expandedCategoryId = null;

    private void ToggleCategory(string categoryId)
    {
        // Accordion behavior - only one category can be open at a time
        if (expandedCategoryId == categoryId)
        {
            expandedCategoryId = null; // Close if already open
        }
        else
        {
            expandedCategoryId = categoryId; // Open this category, close others
        }
    }
}