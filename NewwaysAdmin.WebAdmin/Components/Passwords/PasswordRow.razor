@* File: NewwaysAdmin.WebAdmin/Components/Passwords/PasswordRow.razor *@

@using NewwaysAdmin.Shared.Services.Passwords

<tr>
    <td>@Entry.Label</td>
    <td>
        @if (!string.IsNullOrEmpty(Entry.Username))
        {
            @Entry.Username
            <button class="btn btn-sm btn-outline-secondary ms-1"
                    @onclick="CopyUsername"
                    title="Copy username">
                <i class="bi bi-clipboard"></i>
            </button>
        }
        else
        {
            <span class="text-muted">-</span>
        }
    </td>
    <td>
        @if (_showPassword)
        {
            <code>@Entry.Password</code>
        }
        else
        {
            <span class="text-muted">••••••••</span>
        }
        <button class="btn btn-sm btn-outline-secondary ms-2"
                @onclick="TogglePassword"
                title="@(_showPassword ? "Hide" : "Show")">
            <i class="bi @(_showPassword ? "bi-eye-slash" : "bi-eye")"></i>
        </button>
        <button class="btn btn-sm btn-outline-secondary ms-1"
                @onclick="CopyPassword"
                title="Copy password">
            <i class="bi bi-clipboard"></i>
        </button>
    </td>
    <td>
        @if (!string.IsNullOrEmpty(Entry.Note))
        {
            <span title="@Entry.Note">@TruncateNote(Entry.Note)</span>
        }
        else
        {
            <span class="text-muted">-</span>
        }
    </td>
    <td>
        <button class="btn btn-sm btn-outline-danger"
                @onclick="OnDeleteClick"
                title="Delete">
            <i class="bi bi-trash"></i>
        </button>
    </td>
</tr>

@code {
    [Parameter, EditorRequired]
    public PasswordEntry Entry { get; set; } = null!;

    [Parameter]
    public EventCallback<string> OnDelete { get; set; }

    [Parameter]
    public EventCallback<string> OnCopy { get; set; }

    private bool _showPassword = false;

    private void TogglePassword()
    {
        _showPassword = !_showPassword;
    }

    private async Task CopyPassword()
    {
        await OnCopy.InvokeAsync(Entry.Password);
    }

    private async Task CopyUsername()
    {
        await OnCopy.InvokeAsync(Entry.Username);
    }

    private async Task OnDeleteClick()
    {
        await OnDelete.InvokeAsync(Entry.Id);
    }

    private string TruncateNote(string note, int maxLength = 30)
    {
        if (note.Length <= maxLength) return note;
        return note.Substring(0, maxLength) + "...";
    }
}